<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.5, user-scalable=yes">
    <title>2026 Winter Master</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg: #fdfdfd;
            --math-br: #e3f2fd; --math-ryu: #e0f2f1;
            --math-dw: #f3e5f5; --math-ws: #e8eaf6;
            --phys-sol: #fff3e0; --phys-br: #ffebee;
            --phys-yang: #e1f5fe;
            --algo-hc: #e8f5e9; --algo-os: #f1f8e9;
            --tutor-pk: #fff9c4;
            --holiday: #fffde7;
            --now-line: #ff4d4d;
            --sunday-red: #d32f2f;
            --chk-hw: rgba(255, 0, 0, 0.4);
            --chk-rev: rgba(0, 0, 255, 0.3);
            --today-border: #ff0000;
        }
        body { margin: 0; font-family: 'Pretendard', sans-serif; background: var(--bg); color: #333; overflow-x: hidden; }
        header { background: #222; color: white; padding: 20px; text-align: center; font-weight: bold; font-size: 1.5rem; }
        .section { display: none; padding: 15px; box-sizing: border-box; }
        .section.active { display: block; }
        @media (min-width: 1024px) {
            #home-section.active { display: flex; gap: 20px; max-width: 1400px; margin: 0 auto; align-items: flex-start; }
            .main-content { flex: 1.2; }
            .side-content { flex: 0.8; position: sticky; top: 20px; }
        }
        .dashboard { background: white; border-radius: 15px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; border: 1px solid #eee; }
        .timeline-scroll-area { width: 100%; border: 1px solid #eee; border-radius: 8px; overflow: hidden; display: flex; background: white; }
        .time-column { width: 65px; background: #f8f9fa; border-right: 1px solid #eee; flex-shrink: 0; position: relative; height: 722px; }
        .time-label { position: absolute; width: 100%; text-align: center; font-size: 14px; font-weight: 700; color: #444; height: 38px; line-height: 38px; top: 0; }
        .timeline-container { position: relative; height: 722px; flex-grow: 1; background: white; background-image: linear-gradient(#eee 1px, transparent 1px); background-size: 100% 38px; }
        .now-indicator { position: absolute; left: 0; right: 0; height: 2px; background: var(--now-line); z-index: 20; display: none; pointer-events: none; }
        .ev, .cal-ev { position: absolute; border-radius: 4px; border-left: 2px solid rgba(0,0,0,0.1); z-index: 5; overflow: hidden; display: flex; flex-direction: column; word-break: keep-all; }
        .ev { left: 2px; right: 2px; padding: 4px; }
        .cal-ev { left: 1px; right: 1px; padding: 2px; }
        .half-left { width: 48% !important; left: 1% !important; }
        .half-right { width: 48% !important; left: 51% !important; }
        .split-check-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; z-index: 1; pointer-events: none; }
        .hw-part, .rev-part { flex: 1; height: 100%; }
        .hw-part.active { background: var(--chk-hw); }
        .rev-part.active { background: var(--chk-rev); }
        .ev-content { position: relative; z-index: 2; pointer-events: none; width: 100%; }
        .ev b { font-size: clamp(12px, 1.4vw, 18px); line-height: 1.1; margin-bottom: 2px; display: block; }
        .ev span { font-size: clamp(10px, 1.1vw, 14px); font-weight: 700; opacity: 0.9; }
        .cal-ev b { font-size: clamp(8px, 0.9vw, 11px); line-height: 1.05; display: block; }
        .cal-ev span { font-size: clamp(7px, 0.7vw, 10px); display: block; margin-top: 1px; opacity: 0.8; }
        .calendar-wrapper { width: 100%; border-radius: 8px; overflow: hidden; }
        .grid-container { display: grid; grid-template-columns: repeat(7, 1fr); background: #eee; width: 100%; }
        .day-header { background: #f8f9fa; padding: 8px 0; text-align: center; font-weight: bold; }
        .day-cell { background: white; height: 350px; position: relative; border-right: 1px solid #eee; border-bottom: 1px solid #eee; box-sizing: border-box; }
        .day-num { padding: 6px; font-weight: bold; position: relative; z-index: 2; }
        .is-red { color: var(--sunday-red) !important; }
        .is-today { border: 3px solid var(--today-border) !important; z-index: 10; }
        .edit-controls { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; background: #f9f9f9; padding: 15px; border-radius: 12px; border: 1px solid #ddd; }
        .edit-btn { background: #444; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .edit-active .edit-btn { background: #ff4d4d; }
        .edit-active .cal-ev { cursor: pointer; }
        .math-br { background: var(--math-br); color: #0d47a1; }
        .math-ryu { background: var(--math-ryu); color: #00695c; }
        .math-dw { background: var(--math-dw); color: #4a148c; }
        .math-ws { background: var(--math-ws); color: #1a237e; }
        .phys-sol { background: var(--phys-sol); color: #e65100; }
        .phys-br { background: var(--phys-br); color: #b71c1c; }
        .phys-yang { background: var(--phys-yang); color: #01579b; }
        .algo-hc { background: var(--algo-hc); color: #1b5e20; }
        .algo-os { background: var(--algo-os); color: #33691e; }
        .tutor-pk { background: var(--tutor-pk); color: #827717; }
        .hldy { background: var(--holiday); color: #854d0e; text-align: center; font-weight: bold; }
        .nav-stack { display: flex; flex-direction: column; gap: 12px; margin-top: 10px; }
        .menu-btn-large { background: #222; color: white; border: none; padding: 25px; border-radius: 15px; font-weight: bold; cursor: pointer; font-size: 1.4rem; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .back-btn-huge { background: #444; color: white; border: none; width: 100%; padding: 20px; border-radius: 12px; margin-bottom: 15px; cursor: pointer; font-size: 1.3rem; font-weight: bold; }
        .urgent-item { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border-left: 8px solid #ff4d4d; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .urgent-item h3 { margin: 0 0 5px 0; font-size: 1.2rem; color: #222; }
        .urgent-item p { margin: 0; color: #666; font-size: 1rem; }
    </style>
</head>
<body>

<header>2026 Winter Master</header>

<section id="home-section" class="section active">
    <div class="main-content">
        <div class="dashboard">
            <h2 id="todayDate" style="font-size:1.2rem; margin:5px 0 2px 0;"></h2>
            <p id="statusMessage" style="font-size:1.1rem; font-weight:bold; color:#d32f2f; margin:0 0 10px 0;"></p>
            <div class="timeline-scroll-area">
                <div class="time-column" id="timeLabels"></div>
                <div class="timeline-container" id="todayTimeline">
                    <div id="nowLineHome" class="now-indicator"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="side-content">
        <div class="nav-stack">
            <button class="menu-btn-large" onclick="navigateTo('todo-section')">âœ… í•  ì¼ ì²´í¬í•˜ê¸°</button>
            <button class="menu-btn-large" style="background: #d32f2f;" onclick="navigateTo('urgent-section')">ğŸš¨ ê¸‰í•œ ìˆ™ì œ í™•ì¸í•˜ê¸°</button>
            <button class="menu-btn-large" onclick="navigateTo('schedule-section')">ğŸ—“ï¸ ì „ì²´ ë‹¬ë ¥ ë³´ê¸°</button>
            <a href="https://www.band.us/" target="_blank" class="menu-btn-large" style="background: #03cf5d;">ğŸ’š ë„¤ì´ë²„ë°´ë“œ ë°”ë¡œê°€ê¸°</a>
            <a href="https://www.youtube.com/playlist?list=PL0yYc0K1-YryjgZ6AONKyBP9VjiYwTDWv" target="_blank" class="menu-btn-large">ğŸµ ë°°ê²½ ìŒì•… ì¬ìƒ (YouTube)</a>
        </div>
    </div>
</section>

<section id="urgent-section" class="section">
    <button class="back-btn-huge" onclick="handleBackBtn()">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    <div class="dashboard">
        <h2 style="font-size:1.3rem; color:#d32f2f;">ğŸš¨ ì™„ë£Œë˜ì§€ ì•Šì€ ì§ì „ ìˆ™ì œ</h2>
        <div id="urgentList"></div>
    </div>
</section>

<section id="schedule-section" class="section">
    <button class="back-btn-huge" onclick="handleBackBtn()">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    <div class="edit-controls">
        <button class="edit-btn" id="editToggleBtn" onclick="toggleEditMode()">ğŸ› ï¸ ìˆ˜ì • ëª¨ë“œ ì‹œì‘</button>
    </div>
    <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center; justify-content: center;">
        <button onclick="renderCalendar(1)" style="padding:15px 30px; font-size:1.2rem; font-weight:bold; border-radius:10px; border:1px solid #ccc; background:white;">1ì›”</button>
        <button onclick="renderCalendar(2)" style="padding:15px 30px; font-size:1.2rem; font-weight:bold; border-radius:10px; border:1px solid #ccc; background:white;">2ì›”</button>
        <strong id="monthTitle" style="font-size: 1.5rem; margin-left: 10px;"></strong>
    </div>
    <div class="calendar-wrapper">
        <div class="grid-container" id="calendarGrid"></div>
    </div>
</section>

<section id="todo-section" class="section">
    <button class="back-btn-huge" onclick="handleBackBtn()">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    <div class="dashboard">
        <h2 style="font-size:1.2rem;">ğŸ“‹ í•  ì¼ ë¦¬ìŠ¤íŠ¸</h2>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <input type="text" id="todoInput" style="flex:1; padding:15px; border:1px solid #ddd; border-radius:10px; font-size:1.1rem;" placeholder="í•  ì¼ ì…ë ¥">
            <button onclick="addTodo()" style="padding:0 25px; background:#222; color:white; border:none; border-radius:10px; font-size:1.1rem; font-weight:bold;">ì¶”ê°€</button>
        </div>
        <div id="todoList" style="font-size:1.1rem;"></div>
    </div>
</section>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA5TchtCroGefUyHb7ELwim-p9FQ-wETNk",
        authDomain: "vac-828ed.firebaseapp.com",
        databaseURL: "https://vac-828ed-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "vac-828ed",
        storageBucket: "vac-828ed.firebasestorage.app",
        messagingSenderId: "575598289785",
        appId: "1:575598289785:web:c64a90aac839d5d47745a8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let isEditMode = false;
    let checkData = {};
    let todoList = [];
    let currentMonth = new Date().getMonth() + 1;

    const fixedFullSchedule = {
        "2026-1-1": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'10:00', e:'13:00', h:10, dur:3, c:'math-dw'}, {n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'19:00', e:'22:00', h:19, dur:3, c:'math-dw'}],
        "2026-1-2": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-1-3": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}],
        "2026-1-5": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-1-6": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}],
        "2026-1-7": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'17:00', h:13, dur:4, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-1-8": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-1-9": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-1-10": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-1-12": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-1-13": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}],
        "2026-1-14": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'17:00', h:13, dur:4, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-1-15": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-1-16": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-1-17": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-1-19": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-1-20": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë°•ê°•í˜„ ê³¼ì™¸', s:'13:00', e:'16:00', h:13, dur:3, c:'tutor-pk', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'13:00', e:'16:00', h:13, dur:3, c:'phys-yang', p:'half-right'}],
        "2026-1-21": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-1-22": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-1-23": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-1-24": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-1-26": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-1-27": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë°•ê°•í˜„ ê³¼ì™¸', s:'13:00', e:'16:00', h:13, dur:3, c:'tutor-pk'}],
        "2026-1-28": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-1-29": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-1-30": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-1-31": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-2-2": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-2-3": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë°•ê°•í˜„ ê³¼ì™¸', s:'13:00', e:'16:00', h:13, dur:3, c:'tutor-pk'}],
        "2026-2-4": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-2-5": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-2-6": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-2-7": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-2-9": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-2-10": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë°•ê°•í˜„ ê³¼ì™¸', s:'13:00', e:'16:00', h:13, dur:3, c:'tutor-pk'}],
        "2026-2-11": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-2-12": [{n:'í•™êµë“±êµ', s:'08:00', e:'15:30', h:8, dur:7.5, c:'hldy'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-2-13": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-2-14": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw', p:'half-left'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-ryu', p:'half-right'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-2-16": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-2-18": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-2-19": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-2-20": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-2-21": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}],
        "2026-2-23": [{n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol', p:'half-left'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì¥ì¬í•„', s:'19:20', e:'22:10', h:19.33, dur:2.8, c:'phys-br', p:'half-right'}],
        "2026-2-24": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë°•ê°•í˜„ ê³¼ì™¸', s:'13:00', e:'16:00', h:13, dur:3, c:'tutor-pk'}],
        "2026-2-25": [{n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'13:00', e:'14:50', h:13, dur:1.8, c:'algo-hc'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'15:00', e:'16:50', h:15, dur:1.8, c:'algo-hc'}, {n:'ë¬¼ë¦¬(ì†”ë£¨ì…˜)ì´ì •ìš±', s:'18:30', e:'21:30', h:18.5, dur:3, c:'phys-sol'}],
        "2026-2-26": [{n:'í™•í†µ(ë¸Œë°¸)ì¥ì„¸ìš±T', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-br'}, {n:'ë¯¸ì (ë¸Œë°¸)ë¥˜ìš°ì„±', s:'13:00', e:'16:00', h:13, dur:3, c:'math-ryu'}, {n:'ë¯¸ì (ì›ì†”)ê¹€ê¸°í˜„', s:'18:00', e:'22:00', h:18, dur:4, c:'math-ws'}],
        "2026-2-27": [{n:'ì›ì†” ì•Œê³ ë¦¬ì¦˜', s:'09:30', e:'13:30', h:9.5, dur:4, c:'algo-os'}, {n:'í•œì»´ ì•Œê³ ë¦¬ì¦˜', s:'17:00', e:'18:50', h:17, dur:1.8, c:'algo-hc'}],
        "2026-2-28": [{n:'í™•í†µ(ë‹¤ì›)ê¹€ì°¬ìš©', s:'09:30', e:'12:30', h:9.5, dur:3, c:'math-dw'}, {n:'ë¬¼ë¦¬(ë¸Œë°¸)ì–‘ê¸°ì„ ', s:'16:00', e:'19:20', h:16, dur:3.33, c:'phys-yang'}]
    };

    function navigateTo(id, saveHistory = true) {
        const target = document.getElementById(id);
        if (!target) return;
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        target.classList.add('active');
        if (saveHistory && history.state?.sectionId !== id) history.pushState({ sectionId: id }, '', `#${id}`);
        if(id === 'home-section') updateHomeDashboard();
        if(id === 'schedule-section') { isEditMode = false; renderCalendar(currentMonth); }
        if(id === 'todo-section') loadTodos();
        if(id === 'urgent-section') updateUrgentList();
        window.scrollTo(0,0);
    }
    window.addEventListener('popstate', (e) => navigateTo(e.state?.sectionId || 'home-section', false));
    function handleBackBtn() { history.state?.sectionId !== 'home-section' ? history.back() : navigateTo('home-section'); }

    db.ref('checks').on('value', (s) => { checkData = s.val() || {}; updateHomeDashboard(); if(document.getElementById('urgent-section').classList.contains('active')) updateUrgentList(); });
    db.ref('todos').on('value', (s) => { todoList = s.val() || []; loadTodos(); });

    function toggleCheck(date, idx, type) {
        const key = `${date}_${idx}_${type}`;
        checkData[key] = !checkData[key];
        db.ref('checks').set(checkData);
    }

    function updateHomeDashboard() {
        const now = new Date();
        const dateStr = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;
        const container = document.getElementById('todayTimeline');
        container.querySelectorAll('.ev').forEach(e => e.remove());
        const dayEvs = fixedFullSchedule[dateStr] || [];
        const statusEl = document.getElementById('statusMessage');
        const nowSec = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();
        let currentCls = dayEvs.find(ev => {
            const [sh, sm] = ev.s.split(':').map(Number);
            const [eh, em] = ev.e.split(':').map(Number);
            return nowSec >= (sh*3600+sm*60) && nowSec < (eh*3600+em*60);
        });
        if (currentCls) {
            const [eh, em] = currentCls.e.split(':').map(Number);
            const diff = (eh * 3600 + em * 60) - nowSec;
            statusEl.innerText = `${currentCls.n} ì¢…ë£Œê¹Œì§€ ${Math.floor(diff/60)}ë¶„ ${diff%60}ì´ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
        } else {
            let nextEv = dayEvs.filter(ev => {
                const [sh, sm] = ev.s.split(':').map(Number);
                return (sh * 3600 + sm * 60) > nowSec;
            }).sort((a,b) => (a.h*3600)-(b.h*3600))[0];
            if (nextEv) {
                const [sh, sm] = nextEv.s.split(':').map(Number);
                const diff = (sh * 3600 + sm * 60) - nowSec;
                const h = Math.floor(diff / 3600), m = Math.floor((diff % 3600) / 60), s = diff % 60;
                statusEl.innerText = `ë‹¤ìŒ ìˆ˜ì—… ì‹œì‘ê¹Œì§€ ${h>0?h+'ì‹œê°„ ':''}${m}ë¶„ ${s}ì´ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
            } else {
                const diff = (24 * 3600) - nowSec;
                statusEl.innerText = `ì ë“¤ê¸°ê¹Œì§€ ${Math.floor(diff/3600)}ì‹œê°„ ${Math.floor((diff%3600)/60)}ë¶„ ${diff%60}ì´ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.`;
            }
        }
        dayEvs.forEach((ev, i) => {
            const div = document.createElement('div');
            div.className = `ev ${ev.c} ${ev.p||''}`;
            div.style.top = (ev.h - 6) * 38 + 'px';
            div.style.height = (ev.dur * 38) + 'px';
            const hwKey = `${dateStr}_${i}_hw`, revKey = `${dateStr}_${i}_rev`;
            div.onclick = () => {
                const rect = div.getBoundingClientRect();
                const clickX = window.event.clientX - rect.left;
                toggleCheck(dateStr, i, clickX < rect.width/2 ? 'hw' : 'rev');
            };
            div.innerHTML = `<div class="split-check-layer"><div class="hw-part ${checkData[hwKey]?'active':''}"></div><div class="rev-part ${checkData[revKey]?'active':''}"></div></div><div class="ev-content"><b>${ev.n}</b><span>${ev.s}~${ev.e}</span></div>`;
            container.appendChild(div);
        });
        const line = document.getElementById('nowLineHome');
        const h = now.getHours(), m = now.getMinutes();
        if(h >= 6 && h < 24) { line.style.display = 'block'; line.style.top = ((h - 6) * 38 + (m / 60) * 38) + 'px'; } else { line.style.display = 'none'; }
    }

    function renderCalendar(month) {
        currentMonth = month;
        document.getElementById('monthTitle').innerText = `2026ë…„ ${month}ì›”`;
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d => {
            const h = document.createElement('div'); h.className = 'day-header'; h.innerText = d;
            if(d==='ì¼') h.classList.add('is-red'); grid.appendChild(h);
        });
        const first = new Date(2026, month-1, 1).getDay(), last = new Date(2026, month, 0).getDate();
        for(let i=0; i<first; i++) grid.appendChild(document.createElement('div'));
        for(let d=1; d<=last; d++) {
            const dateStr = `2026-${month}-${d}`;
            const cell = document.createElement('div'); cell.className = 'day-cell';
            const now = new Date(); if(now.getFullYear()===2026 && now.getMonth()+1===month && now.getDate()===d) cell.classList.add('is-today');
            let html = `<div class="day-num ${new Date(2026,month-1,d).getDay()===0?'is-red':''}">${d}</div>`;
            const evs = fixedFullSchedule[dateStr] || [];
            
            // ë‹¬ë ¥ ì¹¸ ì‹œê°„í‘œ ìœ„ì¹˜ ê³„ì‚°: 06ì‹œ~24ì‹œ (ì´ 18ì‹œê°„)ë¥¼ 350px ë†’ì´ì— ë¶„ë°°
            const cellHeight = 350; const baseHour = 6; const totalHours = 18;
            evs.forEach((ev, i) => {
                const hwKey = `${dateStr}_${i}_hw`, revKey = `${dateStr}_${i}_rev`;
                const topPos = ((ev.h - baseHour) / totalHours) * (cellHeight - 30) + 30;
                const heightVal = (ev.dur / totalHours) * (cellHeight - 30);
                html += `
                    <div class="cal-ev ${ev.c} ${ev.p||''}" style="top:${topPos}px; height:${heightVal}px;" onclick="if(isEditMode) { const r=this.getBoundingClientRect(); const x=window.event.clientX-r.left; toggleCheck('${dateStr}',${i}, x<r.width/2?'hw':'rev'); }">
                        <div class="split-check-layer"><div class="hw-part ${checkData[hwKey]?'active':''}"></div><div class="rev-part ${checkData[revKey]?'active':''}"></div></div>
                        <div class="ev-content"><b>${ev.n}</b><span>${ev.s}~${ev.e}</span></div>
                    </div>`;
            });
            cell.innerHTML = html; grid.appendChild(cell);
        }
    }

    function updateUrgentList() {
        const listEl = document.getElementById('urgentList'); listEl.innerHTML = '';
        const now = new Date(); const urgentItems = [];
        const allDates = Object.keys(fixedFullSchedule).sort((a,b) => {
            const [y1,m1,d1] = a.split('-').map(Number); const [y2,m2,d2] = b.split('-').map(Number);
            return new Date(y1, m1-1, d1) - new Date(y2, m2-1, d2);
        });
        for(let i=0; i<7; i++) {
            const targetDate = new Date(); targetDate.setDate(now.getDate() + i);
            const dateStr = `${targetDate.getFullYear()}-${targetDate.getMonth()+1}-${targetDate.getDate()}`;
            const dayClasses = fixedFullSchedule[dateStr];
            if(dayClasses) {
                dayClasses.forEach(cls => {
                    if(cls.c === 'hldy') return;
                    let prevClassInfo = null;
                    for(let j = allDates.indexOf(dateStr) - 1; j >= 0; j--) {
                        const pastDate = allDates[j]; const pastClasses = fixedFullSchedule[pastDate];
                        const foundIdx = pastClasses.findIndex(c => c.n === cls.n);
                        if(foundIdx !== -1) { prevClassInfo = { date: pastDate, idx: foundIdx }; break; }
                    }
                    if(prevClassInfo) {
                        const checkKey = `${prevClassInfo.date}_${prevClassInfo.idx}_hw`;
                        if(!checkData[checkKey] && !urgentItems.some(item => item.name === cls.n)) {
                            urgentItems.push({ name: cls.n, targetDate: dateStr, prevDate: prevClassInfo.date });
                        }
                    }
                });
            }
        }
        if(urgentItems.length === 0) { listEl.innerHTML = '<p style="text-align:center; padding:20px; color:#999;">ë°€ë¦° ìˆ™ì œê°€ ì—†ìŠµë‹ˆë‹¤! ğŸ‘</p>'; }
        else { urgentItems.forEach(item => { const div = document.createElement('div'); div.className = 'urgent-item'; div.innerHTML = `<h3>${item.name}</h3><p>ğŸ“… ë‹¤ìŒ ìˆ˜ì—…: <b>${item.targetDate.split('-')[1]}ì›” ${item.targetDate.split('-')[2]}ì¼</b></p><p style="color:#d32f2f; font-weight:bold; margin-top:5px;">âš ï¸ ${item.prevDate.split('-')[1]}/${item.prevDate.split('-')[2]} ìˆ™ì œ ë¯¸ì™„ë£Œ</p>`; listEl.appendChild(div); }); }
    }

    function toggleEditMode() { isEditMode = !isEditMode; const btn = document.getElementById('editToggleBtn'); btn.innerText = isEditMode ? 'âœ… ìˆ˜ì • ì™„ë£Œ' : 'ğŸ› ï¸ ìˆ˜ì • ëª¨ë“œ ì‹œì‘'; document.getElementById('schedule-section').classList.toggle('edit-active', isEditMode); }
    function addTodo() { const input = document.getElementById('todoInput'); if(!input.value) return; db.ref('todos').set([...todoList, { text: input.value, done: false }]); input.value = ''; }
    function loadTodos() { const el = document.getElementById('todoList'); if(!el) return; el.innerHTML = todoList.length ? '' : '<p style="color:#999; text-align:center;">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>'; todoList.forEach((t, i) => { const div = document.createElement('div'); div.style="display:flex; align-items:center; padding:18px 0; border-bottom:1px solid #f0f0f0;"; div.innerHTML=`<input type="checkbox" style="width:25px; height:25px;" onchange="deleteTodo(${i})"><span style="flex:1; margin:0 15px; font-size:1.2rem;">${t.text}</span>`; el.appendChild(div); }); }
    function deleteTodo(i) { todoList.splice(i, 1); db.ref('todos').set(todoList); }

    window.onload = () => {
        const col = document.getElementById('timeLabels'); for (let i = 6; i <= 24; i++) { const label = document.createElement('div'); label.className = 'time-label'; label.style.top = (i - 6) * 38 + 'px'; label.innerText = i; col.appendChild(label); }
        setInterval(() => {
            const now = new Date(); const month = now.getMonth() + 1; const date = now.getDate();
            let h = now.getHours(); const m = String(now.getMinutes()).padStart(2, '0'); const s = String(now.getSeconds()).padStart(2, '0');
            const ampm = h >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „'; h = h % 12 || 12;
            document.getElementById('todayDate').innerText = `${month}ì›” ${date}ì¼ ${ampm} ${h}ì‹œ ${m}ë¶„ ${s}ì´ˆ ì¼ì •`;
            updateHomeDashboard();
        }, 1000);
    };
</script>
</body>
</html>
